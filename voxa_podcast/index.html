<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>VOXA • Podcast Topic Navigator</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body {
  margin: 0;
  font-family: Poppins, sans-serif;
  background: #020617;
  color: #e5e7eb;
}

/* HEADER */
header {
  padding: 20px 40px;
  background: linear-gradient(135deg, #6366f1, #22d3ee);
  color: white;
}
header h1 { margin: 0; }
header p { margin: 4px 0 0; font-size: 14px; opacity: 0.9; }

/* TIMELINE */
.timeline-wrapper {
  padding: 10px 20px;
  background: #020617;
  border-bottom: 1px solid #1f2933;
}
.timeline-title {
  font-size: 14px;
  margin-bottom: 6px;
}
.timeline {
  display: flex;
  gap: 8px;
  overflow-x: auto;
}
.timeline-bar {
  height: 14px;
  width: 44px;
  border-radius: 7px;
  cursor: pointer;
  opacity: 0.8;
}
.timeline-bar.active {
  outline: 2px solid white;
  opacity: 1;
}

/* MAIN LAYOUT */
.main {
  display: flex;
  height: calc(100vh - 160px);
}

/* PODCAST LIST */
.podcast-list {
  width: 22%;
  padding: 16px;
  border-right: 1px solid #1f2933;
  overflow-y: auto;
}
.podcast {
  padding: 12px;
  margin-bottom: 8px;
  background: #111827;
  border-radius: 10px;
  cursor: pointer;
}
.podcast.active {
  background: #6366f1;
  color: white;
}

/* SEGMENT LIST */
.segment-list {
  width: 28%;
  padding: 16px;
  border-right: 1px solid #1f2933;
  overflow-y: auto;
}
.segment {
  padding: 10px;
  margin-bottom: 6px;
  background: #111827;
  border-radius: 10px;
  cursor: pointer;
  font-size: 14px;
}
.segment.active {
  background: #22d3ee;
  color: #020617;
}

/* CONTENT */
.content {
  width: 50%;
  padding: 24px;
  background: #f8fafc;
  color: #020617;
  overflow-y: auto;
}
.card {
  background: white;
  padding: 18px;
  border-radius: 16px;
  margin-bottom: 20px;
}
pre, p {
  font-family: Poppins, sans-serif;
  font-size: 14px;
  line-height: 1.7;
  white-space: pre-wrap;
}

/* KEYWORDS */
.keyword {
  display: inline-block;
  background: #6366f1;
  color: white;
  padding: 6px 12px;
  border-radius: 999px;
  margin: 4px 4px 0 0;
  font-size: 13px;
}

/* SENTIMENT */
.sentiment {
  display: inline-block;
  padding: 6px 12px;
  border-radius: 999px;
  color: white;
  font-size: 13px;
  margin-top: 8px;
}
.Positive { background: #22c55e; }
.Neutral  { background: #eab308; }
.Negative { background: #ef4444; }

footer {
  text-align: center;
  padding: 8px;
  font-size: 12px;
  opacity: 0.6;
  background: #020617;
}
</style>
</head>

<body>

<header>
  <h1>VOXA</h1>
  <p>Podcast Topic Navigation & Transcription Explorer</p>
</header>

<div class="timeline-wrapper">
  <div class="timeline-title">⏱ Episode Timeline</div>
  <div class="timeline" id="timeline"></div>
</div>

<div class="main">

  <div class="podcast-list" id="podcastList"></div>
  <div class="segment-list" id="segmentList"></div>

  <div class="content">
    <div class="card">
      <h3 id="segTitle">Select a segment</h3>

      <h4>Summary</h4>
      <p id="summary"></p>

      <div id="sentiment"></div>

      <h4>Keywords</h4>
      <div id="keywords"></div>
    </div>

    <div class="card">
      <h3>Transcript</h3>
      <pre id="transcript"></pre>
    </div>
  </div>

</div>

<footer>VOXA • From Speech to Structured Insight</footer>

<script>
const formatTime = s =>
  `${Math.floor(s / 60)}:${String(Math.floor(s % 60)).padStart(2, "0")}`;

fetch("data/segment_metadata.json")
  .then(res => res.json())
  .then(data => {

    /* GROUP BY EPISODE */
    const podcastMap = {};
    data.forEach(seg => {
      if (!podcastMap[seg.episode_id]) podcastMap[seg.episode_id] = [];
      podcastMap[seg.episode_id].push(seg);
    });

    const podcastList = document.getElementById("podcastList");
    const segmentList = document.getElementById("segmentList");
    const timeline = document.getElementById("timeline");

    /* EPISODE SELECTOR */
    Object.keys(podcastMap)
      .sort((a, b) => Number(a) - Number(b))
      .forEach(eid => {
        const div = document.createElement("div");
        div.className = "podcast";
        div.innerText = podcastMap[eid][0].episode_title || `Episode ${eid}`;
        div.onclick = () => loadEpisode(eid, div);
        podcastList.appendChild(div);
      });

    function loadEpisode(eid, el) {
      document.querySelectorAll(".podcast").forEach(p => p.classList.remove("active"));
      el.classList.add("active");

      segmentList.innerHTML = "";
      timeline.innerHTML = "";

      podcastMap[eid].forEach(seg => {
        /* SEGMENT LIST */
        const s = document.createElement("div");
        s.className = "segment";
        s.innerText = seg.title;
        s.onclick = () => activate(seg, s);
        segmentList.appendChild(s);

        /* TIMELINE BAR */
        const bar = document.createElement("div");
        bar.className = "timeline-bar";
        bar.style.background =
          seg.sentiment.label === "Positive" ? "#22c55e" :
          seg.sentiment.label === "Negative" ? "#ef4444" : "#eab308";
        bar.onclick = () => activate(seg, s);
        timeline.appendChild(bar);
      });
    }

    function activate(seg, el) {
      document.querySelectorAll(".segment").forEach(s => s.classList.remove("active"));
      el.classList.add("active");

      document.getElementById("segTitle").innerText = seg.title;
      document.getElementById("summary").innerText = seg.summary;

      document.getElementById("sentiment").innerHTML =
        `<span class="sentiment ${seg.sentiment.label}">
          ${seg.sentiment.label} (${seg.sentiment.score})
        </span>
        ⏱ ${formatTime(seg.time.start)} – ${formatTime(seg.time.end)}`;

      const kw = document.getElementById("keywords");
      kw.innerHTML = "";
      seg.keywords.forEach(k => {
        const span = document.createElement("span");
        span.className = "keyword";
        span.innerText = k;
        kw.appendChild(span);
      });

      fetch(`data/segments/episode_${seg.episode_id}_segment_${seg.local_segment_id}.txt`)
        .then(r => r.text())
        .then(t => document.getElementById("transcript").innerText = t);
    }
  });
</script>

</body>
</html>
